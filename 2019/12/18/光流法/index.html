<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>光流法 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1. 光流法基本原理光流是一种描述像素随时间在图像之间运动的方法，随着时间的流逝，同一个像素会在图像中运动,我们可以追踪他的运动。 光流法应用的前提是灰度不变假设，也就是说$I(x_1,y_1,t_1)&#x3D;I(x_2,y_2,t_2)$，虽然这是一个很苛刻的假设，但我们还是需要认为其在某些场景下具有合理性。 假设在$t+dt$的时刻某个像素运动到了$(x+dx,y+dy)$，我们可以得到：$$I(x">
<meta property="og:type" content="article">
<meta property="og:title" content="光流法">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2019&#x2F;12&#x2F;18&#x2F;%E5%85%89%E6%B5%81%E6%B3%95&#x2F;index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="1. 光流法基本原理光流是一种描述像素随时间在图像之间运动的方法，随着时间的流逝，同一个像素会在图像中运动,我们可以追踪他的运动。 光流法应用的前提是灰度不变假设，也就是说$I(x_1,y_1,t_1)&#x3D;I(x_2,y_2,t_2)$，虽然这是一个很苛刻的假设，但我们还是需要认为其在某些场景下具有合理性。 假设在$t+dt$的时刻某个像素运动到了$(x+dx,y+dy)$，我们可以得到：$$I(x">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https:&#x2F;&#x2F;bucket-1259555870.cos.ap-chengdu.myqcloud.com&#x2F;20191218110333.png">
<meta property="article:published_time" content="2019-12-18T10:40:38.000Z">
<meta property="article:modified_time" content="2019-12-18T11:04:05.883Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;bucket-1259555870.cos.ap-chengdu.myqcloud.com&#x2F;20191218110333.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-光流法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/18/%E5%85%89%E6%B5%81%E6%B3%95/" class="article-date">
  <time datetime="2019-12-18T10:40:38.000Z" itemprop="datePublished">2019-12-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      光流法
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-光流法基本原理"><a href="#1-光流法基本原理" class="headerlink" title="1. 光流法基本原理"></a>1. 光流法基本原理</h1><p>光流是一种描述像素随时间在图像之间运动的方法，随着时间的流逝，同一个像素会在图像中运动,我们可以追踪他的运动。</p>
<p>光流法应用的前提是<strong>灰度不变假设</strong>，也就是说$I(x_1,y_1,t_1)=I(x_2,y_2,t_2)$，虽然这是一个很苛刻的假设，但我们还是需要认为其在某些场景下具有合理性。</p>
<p>假设在$t+dt$的时刻某个像素运动到了$(x+dx,y+dy)$，我们可以得到：<br>$$<br>I(x,y,t) = I(x+dx, y+dy,t+dt)<br>$$<br>如果对上式中右侧进行一阶泰勒展开：<br>$$<br>I(x+dx,y+dy,t+dt) \approx I(x,y,t)+\frac{\partial I}{\partial x}dx + \frac{\partial I}{\partial y}dy + \frac{\partial I}{\partial t}dt<br>$$<br>根据灰度不变假设可以得到：<br>$$<br>\frac{\partial I}{\partial x}dx + \frac{\partial I}{\partial y}dy + \frac{\partial I}{\partial t}dt = 0.<br>$$<br>两侧同时除以$dt$，可以得到：<br>$$<br>\frac{\partial I}{\partial x}\frac{dx}{dt} + \frac{\partial I}{\partial y}\frac{dy}{dt} = -\frac{\partial I}{\partial t}<br>$$<br>其中 $\frac{dx}{dt},\frac{dy}{dt}$ 为像素在$x,y$轴上的运动速度，将他们记为 $u,v$。同时 $\frac{\partial I }{\partial x},\frac{\partial I}{\partial y}$ 记为图像在$x,y$方向上的梯度，分别记为$I_x,I_y$，把图像灰度对于时间的变化量记为 $I_t$，上面的式子可以表示为：<br>$$<br>\begin{bmatrix}<br>I_x&amp;I_y<br>\end{bmatrix}<br>\begin{bmatrix}<br>u\<br>v<br>\end{bmatrix} = - I_t<br>$$<br>我们假设某个$W\times W$的窗口内的像素具有相同的运动，则：<br>$$<br>A=\left[\begin{array}{c}{\left[I_{x}, I_{y}\right]<em>{1}} \ {\vdots} \ {\left[I</em>{x}, I_{y}\right]<em>{k}}\end{array}\right], b=\left[\begin{array}{c}{I</em>{t 1}} \ {\vdots} \ {I_{t k}}\end{array}\right]<br>$$<br>简化后可得：<br>$$<br>A\left[\begin{array}{l}{u} \ {v}\end{array}\right]=-b<br>$$<br>这是一个超定方程(方程个数大于未知数个数)，可以使用最小二乘法求解：<br>$$<br>\begin{bmatrix}<br>u\<br>v<br>\end{bmatrix}^* = -(A^TA)^{-1}A^Tb<br>$$</p>
<blockquote>
<p>超定方程组是指方程个数大于未知量个数的方程组，在方程$Ax=b$两边乘以$A^T$，所以该方程有唯一解且为原方程的最小二乘解：<br>$$<br>\begin{equation}<br>\begin{split}<br>A^TAx=A^Tb<br>\end{split}<br>\<br>x=(A^TA)^{-1}A^Tb<br>\end{equation}<br>$$</p>
</blockquote>
<p>总结一下，光流法<strong>基于三个假设</strong>：</p>
<ul>
<li><strong>灰度不变</strong>，所以$I(x+dx,y+dy,t+dt) =I(x,y,t)$</li>
<li><strong>小运动</strong>，所以我们可以取一阶泰勒展开</li>
<li><strong>邻域内光流不变</strong>，所以我们可以取$W\times W$的小窗口</li>
</ul>
<h1 id="2-金字塔光流法"><a href="#2-金字塔光流法" class="headerlink" title="2. 金字塔光流法"></a>2. 金字塔光流法</h1><p>光流法重要前提是小运动，也就是说图像随时间变化缓慢，这样灰度才能求偏导，最理想的条件当然是相邻帧图片间隔1个像素。为了解决运动过快导致的误差较大问题，我们可以通过<strong>减少图像中物体的位移</strong>。</p>
<p>缩小图像尺寸能有效减少位移，比如图像为400×400时，物体单位时间位移为[16,16]，那么当图像缩小为200×200时，位移变为[8,8]。缩小尺寸的办法可以使用<strong>金字塔分层</strong>。</p>
<p>高斯金字塔的概念在SIFT特征检测中已经详细说明。通过高斯金字塔能形成<strong>组（Octave）和层（Level或Interval）</strong>。</p>
<img src="https://bucket-1259555870.cos.ap-chengdu.myqcloud.com/20191218110333.png" style="zoom:50%;" />

<p>下面开始公式推导，假设$I,J$是两幅相邻运动图像。图像$I$的点$(x,y)$对应了图像$J$的点$(x+dx,y+dy)$，也就是说：<br>$$<br>I(x,y)=J(x+dx,y+dy)<br>$$<br>当然这之间肯定会存在误差，写出一片领域下的误差函数：<br>$$<br>e=\sum_{x=u_{x}-\omega_{x}}^{u_{x}+\omega_{x}} \sum_{y=u_{y}-\omega_{y}}^{u_{y}+\omega_{y}}\left(I(x, y)-J\left(x+d_{x}, y+d_{y}\right)\right)^{2}<br>$$<br>假设图像的尺寸每次缩放为原来的一半，共缩放了$Lm$组，第0组误差为$e(d)$，则每组的光流计算结果为为：<br>$$<br>g(L)=\frac{g(0)}{2^L}<br>$$<br>这并不是准确的结果，还得加上残差：<br>$$<br>g(L)<em>{real}=g(L)+d(L)<br>$$<br>反馈到第$L-1$层：<br>$$<br>g(L-1)=2[g(L)+d(L)]<br>$$<br>对于每一层，我们都希望光流的计算基于邻域内所有点匹配误差和最小化：<br>$$<br>e(L)=\sum</em>{x=u_{x}^{L}-\omega_{x}}^{u_{x}^{L}+w_x} \sum_{y=u_{y}^{L}-\omega_{y}}^{u_{y}^{L}+\omega_{y}}\left(I^{L}(x, y)-J^{L}\left(x+g_{x}^{L}+d_{x}^{L}, y+g_{y}^{L}+d_{y}^{L}\right)\right)^{2}<br>$$<br>具体算法是：</p>
<ol>
<li>利用最小二乘法计算最顶层的最小光流</li>
<li>更新光流$v=2*v$，将光流方向传递到下一层，计算最小光流</li>
<li>持续传递，直到传递到原图像输出</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/18/%E5%85%89%E6%B5%81%E6%B3%95/" data-id="ck4o2tus5001bu4vy02hpc465" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/12/18/%E8%87%AA%E9%80%82%E5%BA%94%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E5%8C%96/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          自适应直方图均衡化
        
      </div>
    </a>
  
  
    <a href="/2019/12/18/SIFT%E7%89%B9%E5%BE%81%E6%A3%80%E6%B5%8B/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">SIFT特征检测</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/12/27/CPP%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B4-%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E6%A8%A1%E6%9D%BF/">CPP泛型编程4-可变参数模板</a>
          </li>
        
          <li>
            <a href="/2019/12/27/CPP%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B3-%E9%9D%9E%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%A8%A1%E6%9D%BF%E7%B1%BB%E5%8F%82%E6%95%B0/">CPP泛型编程3-非类型的模板参数</a>
          </li>
        
          <li>
            <a href="/2019/12/27/CPP%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B2-%E7%B1%BB%E6%A8%A1%E6%9D%BF/">CPP泛型编程2-类模板</a>
          </li>
        
          <li>
            <a href="/2019/12/27/CPP%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B1-%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF/">CPP泛型编程1-函数模板</a>
          </li>
        
          <li>
            <a href="/2019/12/26/CPP%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%80%BB%E7%BB%934-%E5%B9%B6%E5%8F%91%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%AE%9E%E4%BE%8B/">CPP多线程总结4-并发数据结构设计实例</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>